{% extends "base.html" %}

{% block title %}Login — Custora AI{% endblock %}

{% block extra_css %}
<style>
  /* ============================================================
     LOGIN PAGE — full-viewport centered layout
  ============================================================ */

  /* Override page-body padding for auth pages */
  .page-body {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 40px 20px 80px;
    min-height: calc(100vh - var(--nav-height) - 85px);
  }

  .page-body > .container {
    display: flex;
    align-items: center;
    justify-content: center;
    padding-top: 0;
  }

  /* ── Auth Card ── */
  .auth-card {
    width: 100%;
    max-width: 440px;
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-xl);
    padding: 44px 40px 40px;
    box-shadow: var(--shadow-card);
    position: relative;
    overflow: hidden;
    animation: card-in 0.5s cubic-bezier(0.22, 1, 0.36, 1) both;
  }

  @keyframes card-in {
    from { opacity: 0; transform: translateY(20px) scale(0.98); }
    to   { opacity: 1; transform: translateY(0)  scale(1); }
  }

  /* Subtle gradient top border */
  .auth-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: var(--brand-gradient);
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
  }

  /* Glow behind card */
  .auth-card::after {
    content: '';
    position: absolute;
    top: -60px; left: 50%;
    transform: translateX(-50%);
    width: 300px; height: 200px;
    background: radial-gradient(ellipse,
      rgba(155,45,202,0.1) 0%,
      transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  .auth-card > * { position: relative; z-index: 1; }

  /* ── Card Header ── */
  .auth-logo-wrap {
    display: flex;
    justify-content: center;
    margin-bottom: 28px;
  }

  .auth-logo-img {
    height: 40px;
    width: auto;
    object-fit: contain;
  }

  .auth-logo-dark  { display: block; }
  .auth-logo-light { display: none;  }
  [data-theme="light"] .auth-logo-dark  { display: none;  }
  [data-theme="light"] .auth-logo-light { display: block; }

  .auth-heading {
    font-size: 1.7rem;
    font-weight: 800;
    letter-spacing: -0.04em;
    color: var(--text-primary);
    text-align: center;
    line-height: 1.15;
    margin-bottom: 8px;
  }

  .auth-subheading {
    font-size: 0.875rem;
    color: var(--text-secondary);
    text-align: center;
    line-height: 1.6;
    margin-bottom: 32px;
  }

  /* ── Divider ── */
  .auth-divider {
    height: 1px;
    background: var(--border);
    margin: 0 0 28px;
  }

  /* ── Form ── */
  .auth-form {
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .auth-field {
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-bottom: 18px;
  }

  .auth-label {
    font-size: 0.76rem;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-muted);
    padding-left: 2px;
  }

  .auth-input-wrap {
    position: relative;
  }

  .auth-input-icon {
    position: absolute;
    top: 50%; left: 14px;
    transform: translateY(-50%);
    width: 16px; height: 16px;
    color: var(--text-muted);
    pointer-events: none;
    transition: color var(--transition);
  }

  .auth-input {
    width: 100%;
    padding: 12px 16px 12px 42px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-family: var(--font-family);
    font-size: 0.9rem;
    font-weight: 400;
    outline: none;
    transition: border-color var(--transition), box-shadow var(--transition), background var(--transition);
    -webkit-appearance: none;
  }

  .auth-input:focus {
    border-color: var(--brand-purple);
    box-shadow: 0 0 0 3px rgba(155,45,202,0.15);
    background: var(--bg-surface);
  }

  .auth-input:focus ~ .auth-input-icon,
  .auth-input-wrap:focus-within .auth-input-icon {
    color: var(--brand-purple);
  }

  .auth-input::placeholder { color: var(--text-muted); }

  /* Error state */
  .auth-input.is-error {
    border-color: var(--brand-pink);
    box-shadow: 0 0 0 3px rgba(247,37,133,0.12);
  }

  /* ── Error message block ── */
  .auth-error {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 14px;
    background: rgba(247,37,133,0.08);
    border: 1px solid rgba(247,37,133,0.22);
    border-radius: var(--radius-md);
    color: #f72585;
    font-size: 0.83rem;
    font-weight: 500;
    line-height: 1.5;
    margin-bottom: 20px;
    animation: flash-in 0.3s ease both;
  }

  [data-theme="light"] .auth-error {
    background: rgba(247,37,133,0.06);
    color: #c41062;
  }

  @keyframes flash-in {
    from { opacity: 0; transform: translateY(-6px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .auth-error-icon { font-size: 0.9rem; flex-shrink: 0; }

  /* ── Forgot password row ── */
  .auth-row {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    margin-top: -10px;
    margin-bottom: 24px;
  }

  .auth-forgot {
    font-size: 0.78rem;
    color: var(--text-muted);
    text-decoration: none;
    font-weight: 500;
    transition: color var(--transition);
  }

  .auth-forgot:hover { color: var(--brand-purple); }

  /* ── Submit Button ── */
  .auth-submit {
    width: 100%;
    padding: 13px;
    background: var(--brand-gradient);
    color: #fff;
    border: none;
    border-radius: var(--radius-pill);
    font-family: var(--font-family);
    font-size: 0.95rem;
    font-weight: 700;
    letter-spacing: 0.01em;
    cursor: pointer;
    box-shadow: var(--shadow-btn);
    transition: transform 0.18s ease, box-shadow 0.18s ease, opacity 0.18s ease;
    position: relative;
    overflow: hidden;
  }

  .auth-submit::before {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(255,255,255,0);
    transition: background 0.18s ease;
  }

  .auth-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 36px rgba(247,37,133,0.45);
  }

  .auth-submit:hover::before { background: rgba(255,255,255,0.06); }
  .auth-submit:active  { transform: translateY(0); }

  /* Loading state */
  .auth-submit.loading {
    pointer-events: none;
    opacity: 0.75;
  }

  .auth-submit.loading::after {
    content: '';
    display: inline-block;
    width: 14px; height: 14px;
    border: 2px solid rgba(255,255,255,0.4);
    border-top-color: #fff;
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
    margin-left: 8px;
    vertical-align: middle;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  /* ── Footer link ── */
  .auth-footer-text {
    text-align: center;
    margin-top: 24px;
    font-size: 0.83rem;
    color: var(--text-muted);
  }

  .auth-footer-text a {
    color: var(--brand-purple);
    font-weight: 600;
    text-decoration: none;
    transition: color var(--transition);
  }

  .auth-footer-text a:hover {
    color: var(--brand-pink);
  }

  /* ── Background orbs ── */
  .auth-bg-orb {
    position: fixed;
    border-radius: 50%;
    pointer-events: none;
    z-index: 0;
  }

  .orb-1 {
    width: 400px; height: 400px;
    background: radial-gradient(circle, rgba(247,37,133,0.07) 0%, transparent 70%);
    top: -100px; left: -100px;
  }

  .orb-2 {
    width: 500px; height: 500px;
    background: radial-gradient(circle, rgba(67,97,238,0.07) 0%, transparent 70%);
    bottom: -150px; right: -100px;
  }

  /* Responsive */
  @media (max-width: 480px) {
    .auth-card {
      padding: 36px 24px 32px;
    }
    .auth-heading { font-size: 1.45rem; }
  }
</style>
{% endblock %}


{% block content %}

<!-- Background orbs -->
<div class="auth-bg-orb orb-1"></div>
<div class="auth-bg-orb orb-2"></div>

<div class="auth-card">

  <!-- Logo -->
  <div class="auth-logo-wrap">
    <img
      class="auth-logo-img auth-logo-dark"
      src="{{ url_for('static', filename='images/dark-logo.png') }}"
      alt="Custora AI"
    />
    <img
      class="auth-logo-img auth-logo-light"
      src="{{ url_for('static', filename='images/light-logo.png') }}"
      alt="Custora AI"
    />
  </div>

  <!-- Heading -->
  <h1 class="auth-heading">Welcome back</h1>
  <p class="auth-subheading">
    Sign in to your Custora AI account<br/>to access your churn intelligence dashboard.
  </p>

  <div class="auth-divider"></div>

  <!-- Error message (Flask flash / form errors) -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% for category, message in messages %}
      {% if category in ['danger', 'error'] %}
        <div class="auth-error">
          <span class="auth-error-icon">✕</span>
          <span>{{ message }}</span>
        </div>
      {% endif %}
    {% endfor %}
  {% endwith %}

  <!-- Login Form — field names preserved: email, password -->
  <form method="POST" class="auth-form" id="loginForm" novalidate>

    <!-- Email -->
    <div class="auth-field">
      <label class="auth-label" for="email">Email address</label>
      <div class="auth-input-wrap">
        <svg class="auth-input-icon" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M2.5 5.5A1.5 1.5 0 014 4h12a1.5 1.5 0 011.5 1.5v9A1.5 1.5 0 0116 16H4a1.5 1.5 0 01-1.5-1.5v-9z"/>
          <path d="M2.5 5.5l7.5 5.25 7.5-5.25" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <input
          class="auth-input"
          type="email"
          name="email"
          id="email"
          placeholder="you@company.com"
          required
          autocomplete="email"
        />
      </div>
    </div>

    <!-- Password -->
    <div class="auth-field">
      <label class="auth-label" for="password">Password</label>
      <div class="auth-input-wrap">
        <svg class="auth-input-icon" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
          <rect x="3" y="9" width="14" height="9" rx="2"/>
          <path d="M7 9V6.5a3 3 0 016 0V9" stroke-linecap="round"/>
        </svg>
        <input
          class="auth-input"
          type="password"
          name="password"
          id="password"
          placeholder="Enter your password"
          required
          autocomplete="current-password"
        />
      </div>
    </div>

    <!-- Forgot password -->
    <div class="auth-row">
      <a href="#" class="auth-forgot">Forgot password?</a>
    </div>

    <!-- Submit -->
    <button type="submit" class="auth-submit" id="loginSubmit">
      Sign in to Custora AI
    </button>

  </form>

  <!-- Register link -->
  <p class="auth-footer-text">
    Don't have an account?&nbsp;
    <a href="/register">Create one free →</a>
  </p>

</div>

{% endblock %}


{% block extra_js %}
<script>
  /* ── Input error state on invalid submit ── */
  const loginForm = document.getElementById('loginForm');
  const loginSubmit = document.getElementById('loginSubmit');

  loginForm.addEventListener('submit', function(e) {
    let valid = true;

    loginForm.querySelectorAll('.auth-input').forEach(input => {
      input.classList.remove('is-error');
      if (!input.checkValidity()) {
        input.classList.add('is-error');
        valid = false;
      }
    });

    if (!valid) {
      e.preventDefault();
      /* Shake animation on card */
      const card = document.querySelector('.auth-card');
      card.animate([
        { transform: 'translateX(0)' },
        { transform: 'translateX(-6px)' },
        { transform: 'translateX(6px)' },
        { transform: 'translateX(-4px)' },
        { transform: 'translateX(0)' }
      ], { duration: 320, easing: 'ease' });
      return;
    }

    /* Loading state */
    loginSubmit.classList.add('loading');
    loginSubmit.textContent = 'Signing in';
  });

  /* ── Remove error state on input ── */
  document.querySelectorAll('.auth-input').forEach(input => {
    input.addEventListener('input', () => input.classList.remove('is-error'));
    input.addEventListener('focus', () => input.classList.remove('is-error'));
  });
</script>
{% endblock %}